<!DOCTYPE HTML>
<html>
<head>
	<title>Inpainting API test</title>
	<meta http-equiv="content-type" content="text/html;charset=utf-8" />
	<script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>
	<script class="jsbin" src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.0/jquery-ui.min.js"></script>
	<style>
		body{
			width: 500px;
			margin: auto;
			background-color: #eee;
		}
		#content {
			//background-color: hotpink;
			margin: auto;
			//background-image: url(img/logo_transp.png);
			background-repeat: no-repeat;
			background-position: 100% 0;
			border-radius: 10px;
			min-height: 500px;
			padding: 15px;
		}
		#footer{
			text-align: center;
			position: absolute;
			text-align: center;
			bottom: 0;
			text-decoration: none;
		}
		h1{
			padding-left: 10px;
		}
		#preview
		{
			width: 500px;
			height: 650px;
			border-color: gray;
			border-style: solid;
			border-radius: 15px;
			border-width: 3px;
			margin-bottom: 5px;
			text-align: center;
			background-size: 500px 650px;
			background-repeat: no-repeat;
		}
		#button
		{
		  background-color: yellow;
		  border: none;
		  color: black;
		  padding: 15px 32px;
		  text-align: center;
		  font-weight: bold;
		  text-decoration: none;
		  display: inline-block;
		  font-size: 16px;
		}
		.img-busy
		{
			filter: blur(8px);
			animation-name: scanning;
			animation-duration: 1s;
			animation-direction: alternate;
			animation-iteration-count: 50;
			animation-timing-function: ease-in-out
		}
		@keyframes scanning {
		  from {filter: blur(8px);}
		  to {filter: blur(14px);}
		}
		.mask-finished
		{
			visibility: hidden;
		}
	</style>
	<script>
	function allowDrop(ev) {
	  ev.preventDefault();
	}

	function drag(ev) {
	  ev.dataTransfer.setData("text", ev.target.id);
	}

	function drop(ev) {
	  ev.preventDefault();
	  var data = ev.dataTransfer.getData("text");
	  ev.target.appendChild(document.getElementById(data));
	}
	</script>
</head>
<body>
	<div id="content">
		<h1>Inpainting Example</h1>
		<form enctype="multipart/form-data" action="http://localhost:8069/api/inpaint" method="POST">
			<input type="hidden" name="MAX_FILE_SIZE" value="100000" />
			<tt>Image: <input name="Image" id="Image" type="file" onchange="UpdateImg(this, false);"/><br>
			Mask:&nbsp; </tt><input name="Mask" id="Mask" type="file" onchange="UpdateImg(this, true);"/></tt>
			
			<br><br>
			
			<div id="preview">
				<img id="mask" class="mask-finished" alt="Drag Image Here">
			</div>
			
			<input type="button" id="inpaint" value="inpaint" />
		</form>
		<div id="footer"><a href="https://ferib.dev/">Created by Ferib Hellscream</a></div>
	</div>
	<script>
function ProcessImage(){
	$.post( "http://localhost:8069/api/inpaint", function( data ) {
		('#preview').css("background-image", "url('" + data + "')");
	});
}
function UpdateImg(input, isMask) {
	if (input.files && input.files[0]) {
		var reader = new FileReader();

		if(isMask){
			reader.onload = function (e) {
			$('#mask')
				.attr('src', e.target.result)
				.width(500)
				.height(650)
				.removeClass("mask-finished");
			};
		}else{
			reader.onload = function (e) {
				$('#preview')
					.css("background-image", "url('" + e.target.result + "')");
			};
		}
		reader.readAsDataURL(input.files[0]);
	}
}

$(document).ready(function(){

    $("#inpaint").click(function(){

        var fd = new FormData();

        var imagefile = $('#Image')[0].files[0];
		var maskfile = $('#Mask')[0].files[0];
	
        fd.append('file',imagefile);
        fd.append('file',maskfile);
		
		console.log("Started Request");
		$('#preview').addClass("img-busy");
		
        $.ajax({
            url: 'http://localhost:8069/api/inpaint',
            type: 'post',
            data: fd,
            contentType: false,
            processData: false,
            success: function(response){
                if(response != 0){
					console.log("Done");
					console.log(response);
                    $("#mask")
						.attr("src","/")
						.addClass("mask-finished");
					$('#preview')
						.css("background-image", "url('" + response + "')")
						.removeClass("img-busy");
                }else{
					console.log("Unknown Error on Processing Image");
                }
            },
        });
    });
});

</script>
</body>
</html>
